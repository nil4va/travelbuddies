<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corendon | Matches</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.fys.cloud/fyscloud/0.0.3/fyscloud.min.js"></script>
    <script src="/assets/js/fyscloud/config/config.js"></script>

    <!-- Session -->
    <script src="/assets/js/session/entity/user.js"></script>

    <script src="/assets/js/database/repository/userRepository.js"></script>
    <script src="/assets/js/database/inserter/sessionInserter.js"></script>

    <script src="/assets/js/utils/cookie.js"></script>
    <script src="/assets/js/utils/random.js"></script>

    <script src="/assets/js/session/enum/sessionEnum.js"></script>
    <script src="/assets/js/session/session.js"></script>

    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/elementBuilder.js"></script>

    <script src="/assets/js/pages/matches.js"></script>
</head>

<body>
    <!-- Include: Header -->
    <div class="js-element-builder" data-file="header"
        data-variables='{"title":"Interesses (tags)", "subTitle": "Voeg tags toe aan jouw profiel, en kom in aanraking met meer travelbuddies"}'>
    </div>



    <!-- Main content -->
    <main id="categories" class="container text-black mb-4">
        <!-- Include: Ad -->
        <div class="js-element-builder" data-file="ad"></div>
        <div class="amount-of-tags">
            <h1><span class="text-profiel"> <span class="name-and-amout-of-tags, name-of-user"></span>, momenteel heb
                    jij <span class="name-and-amout-of-tags tag-counter">0</span>
                    tags&nbsp;!</span>
            </h1>
            <div class="profielfoto">
                <img src="assets/img/profile-female.jpg">
            </div>
        </div>
        <div class="scroll-current-tags"> <span class="js-help-text">Laat iedereen weten wat je interesses zijn door ze
                toe te voegen aan je
                profiel. klik op een categorie om te beginnen!</span>
        </div>
        <div class="explanaition-tags">voeg tags toe aan jouw profiel, en kom in aanraking met meer travelbuddy's!</div>

        <div class="row">
            <div class="col-md-4">
                <button class="btn btn-danger mt-5 text-right" onclick="goBack()">Go Back</button>
            </div>

            <div class="col-md-4 text-center">
                <p> ⭒ Kies een categorie ⭒ </p>
            </div>

            <div class="col-md-4">
                <button id="explanationButton" class="btn btn-danger mt-5 ">klik voor uitleg</button>
            </div>

            <div id="myModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h1>
                        Wat zijn Tags ?
                    </h1>
                    <p>Laat iedereen weten wat je interesses zijn door ze toe te voegen aan je profiel. Zo vind je je perfecte buddy, speciaal voor jou !  <br><br> klik op
                        een
                        categorie om te beginnen !</p>
                </div>

            </div>

        </div>

        <div class="row">
            <div class="col-md-6">
                <button class="collapsible button">
                    <div class="logo-for-catagories"><img
                            src="assets/img/Hobbies-hobby-activity-freetime-lifestyle-512.webp" class="image-hobby">
                    </div><span class="button">Hobbys</span>
                </button>
                <div class="content content-hobbys">
                    <div class="input-group mb-3 mt-3">
                        <input type="text" class="form-control searchbox" placeholder="Search..">
                        <div class="input-group-append">
                            <button class="btn btn-dark" type="button">find your tag !</button>
                        </div>
                    </div>
                </div>
                <button class="collapsible button">
                    <div class="logo-for-catagories"><img src="assets/img/movies-logo.png" class="image-movies">
                    </div>
                    <span class="button">Movies</span>
                </button>
                <div class="content content-movies">
                    <div class="input-group mb-3 mt-3">
                        <input type="text" class="form-control searchbox" placeholder="Search..">
                        <div class="input-group-append">
                            <button class="btn btn-dark" type="button">find your tag !</button>
                        </div>
                    </div>
                </div>
                <button class="collapsible button">
                    <div class="logo-for-catagories"><img src="assets/img/country-logo.png" class="image-countries">
                    </div><span class="button">Countries </span>
                </button>
                <div class="content content-countries">
                    <div class="input-group mb-3 mt-3">
                        <input type="text" class="form-control searchbox" placeholder="Search..">
                        <div class="input-group-append">
                            <button class="btn btn-dark" type="button">find your tag !</button>
                        </div>
                    </div>
                </div>
                <button class="collapsible button">
                    <div class="logo-for-catagories"><img src="assets/img/books.png" class="image-books">
                    </div><span class="button">Books</span>
                </button>
                <div class="content content-books">
                    <div class="input-group mb-3 mt-3">
                        <input type="text" class="form-control searchbox" placeholder="Search..">
                        <div class="input-group-append">
                            <button class="btn btn-dark" type="button">find your tag !</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <button class="collapsible button">
                    <div class="logo-for-catagories"><img src="assets/img/music-icon.png" class="image-music"></div>
                    <span class="button">Music</span>
                </button>
                <div class="content content-music">
                    <div class="input-group mb-3 mt-3">
                        <input type="text" class="form-control searchbox" placeholder="Search..">
                        <div class="input-group-append">
                            <button class="btn btn-dark" type="button">find your tag !</button>
                        </div>
                    </div>
                </div>
                <button class="collapsible button">
                    <div class="logo-for-catagories"><img src="assets/img/games-logo.png" class="image-games"></div>
                    <span class="button">Games</span>
                </button>
                <div class="content content-games">
                    <div class="input-group mb-3 mt-3">
                        <input type="text" class="form-control searchbox" placeholder="Search..">
                        <div class="input-group-append">
                            <button class="btn btn-dark" type="button">find your tag !</button>
                        </div>
                    </div>
                </div>
                <button class="collapsible button">
                    <div class="logo-for-catagories"><img src="assets/img/sports-logo.png" class="image-sports">
                    </div>
                    <span class="button">Sports</span>
                </button>
                <div class="content content-sports">
                    <div class="input-group mb-3 mt-3">
                        <input type="text" class="form-control searchbox" placeholder="Search..">
                        <div class="input-group-append">
                            <button class="btn btn-dark" type="button">find your tag !</button>
                        </div>
                    </div>
                </div>
                <button class="collapsible button">
                    <div class="logo-for-catagories"><img src="assets/img/language-logo.jpg" class="image-languages">
                    </div><span class="button">Languages</span>
                </button>
                <div class="content content-languages">
                    <div class="input-group mb-3 mt-3">
                        <input type="text" class="form-control searchbox" placeholder="Search..">
                        <div class="input-group-append">
                            <button class="btn btn-dark" type="button">find your tag !</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Include: Chatbox -->
    <div class="js-element-builder" data-file="chatbox"></div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/elementBuilder.js"></script>

    <script>
        var modal = document.getElementById("myModal");

        var btn = document.getElementById("explanationButton");

        var span = document.getElementsByClassName("close")[0];

        btn.onclick = function () {
            modal.style.display = "block";
        }

        span.onclick = function () {
            modal.style.display = "none";
        }

        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        var coll = document.getElementsByClassName("collapsible button");
        var i;


        for (i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function () {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                }
            });
        }

        function goBack() {
            window.history.back();
        }

        $(document).ready(function () {
            $(".searchbox").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $(this).parent().parent().find('.tag-button').filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });

        $(document).ready(async () => {
            /*
             let categories_and_tags = {
                 "Hobbys": [
                     "Tuinieren",
                     "Gamen",
                     "Fotografie",
                     "Lezen",
                     "Kaartspelen",
                     "Verzamelen",
                     "Tekenenen",
                     "Schrijven",
                     "Zingen",
                     "Instrument bespelen",
                     "Mediteren",
                     "Tarot",
                     "Publiek spreken",
                     "Life Coaching",
                     "Trouwfeesten plannen",
                     "Buiten lopen",
                     "Muziek componeren",
                     "Klimmen",
                     "Nieuwe Talen leren",
                     "Kaligrafie"
                 ],

                 "Movies": [
                     "Disney",
                     "Silent",
                     "Science fiction",
                     "Romantiek",
                     "Musical",
                     "LGBT",
                     "Horror",
                     "Fantasie",
                     "Documentaire",
                     "Komedie",
                     "Anime"
                 ],

                 "Countries": [
                     "Frankrijk",
                     "Spanje",
                     "Amerika",
                     "China",
                     "Italië",
                     "Turkije",
                     "Mexico",
                     "Thailand",
                     "Duitsland",
                     "Verenigde Koninkrijk",
                     "Marokko",
                     "Egypte",
                     "Zuid-Afrika",
                     "Tunesië",
                     "Algerije",
                     "Zimbabwe",
                     "Ivoorkust",
                     "Botswanië",
                     "Namibië",
                     "Mozambique",
                     "Canada",
                     "Argentinië",
                     "Dominicaanse Republiek",
                     "Brazilië",
                     "Chili",
                     "Cuba",
                     "Peru",
                     "Colombië",
                     "Japan",
                     "Malesië",
                     "Hong Kong",
                     "Macau",
                     "Vietnam",
                     "India",
                     "Zuid-Korea",
                     "Oostenrijk",
                     "Portugal",
                     "Griekenland",
                     "Verenigde Arabische Emiraten",
                     "Saudi-Arabië",
                     "Sudan",
                     "Uganda",
                     "Kenya",
                     "Costa Rica",
                     "Panama",
                     "Singapore",
                     "Nederland"
                 ],

                 "Books": [
                     "True Crime",
                     "Self-Help",
                     "Poetry",
                     "Memoir",
                     "History",
                     "Essays",
                     "Cookbooks",
                     "Biographies en Autobiographies",
                     "Suspense en Thrillers",
                     "Short Stories",
                     "Science Fiction",
                     "Romance",
                     "Literary Fiction",
                     "Horror Books",
                     "Historical Fiction",
                     "Fantasy",
                     "Detective en Mystery",
                     "Comic Book or Graphic Novel",
                     "Classics",
                     "Action en Adventure"
                 ],

                 "Music": [
                     "Blues",
                     "Jazz",
                     "Rhythm en Blues",
                     "RocknRoll",
                     "Rock",
                     "Country",
                     "Soul",
                     "Dance",
                     "Hip Hop",
                     "RnB",
                     "Rap"
                 ],

                 "Games": [
                     "Action",
                     "Action-Adventure",
                     "Adventure",
                     "Role-playing",
                     "Simulation",
                     "Strategy",
                     "Esports",
                     "Simulation",
                     "Art Game",
                     "Trivia Game",
                     "Part Game",
                     "Board Game or Card Game",
                     "Educational Game"
                 ],

                 "Sports": [
                     "Soccer",
                     "Volleyball",
                     "Basketball",
                     "Romance",
                     "Swimming/Polo",
                     "Tennis",
                     "Badminton",
                     "Gymnastic",
                     "Golven",
                     "Boksen",
                     "Schaken",
                     "Yoga"
                 ],

                 "Languages": [
                     "Engels",
                     "Mandarijn Chinees",
                     "Hindi",
                     "Spaans",
                     "Arabisch",
                     "Bengaals",
                     "Russisch",
                     "Portugees",
                     "Nederlands",
                     "Frans",
                     "Duits",
                     "Italië",
                     "Roemeens",
                     "Turks",
                     "Vlaams",
                     "Fries"
                 ],
             };
             */

            async function testScores() {
                await FYSCloud.API.queryDatabase(
                    "DELETE FROM `tag_category_score` WHERE `tag_category_score`.`userId` BETWEEN 1 AND 1000000;"
                )

                let usersAndScores = [];

                for (let i = 0; i < 10; i++) {
                    usersAndScores.push({
                        userId: i,

                        hobbys: Math.floor(Math.random() * Math.floor(20)),
                        movies: Math.floor(Math.random() * Math.floor(20)),
                        countries: Math.floor(Math.random() * Math.floor(20)),
                        books: Math.floor(Math.random() * Math.floor(20)),
                        music: Math.floor(Math.random() * Math.floor(20)),
                        games: Math.floor(Math.random() * Math.floor(20)),
                        sports: Math.floor(Math.random() * Math.floor(20)),
                        languages: Math.floor(Math.random() * Math.floor(20))
                    })
                }

                let insertValues = [];

                for (let userAndScores of usersAndScores) {
                    insertValues.push("('" + userAndScores.userId + "', '" + userAndScores.hobbys +
                        "', '" + userAndScores.movies + "', '" + userAndScores.countries + "', '" +
                        userAndScores.books + "', '" + userAndScores.music + "', '" + userAndScores
                        .games + "', '" + userAndScores.sports + "', '" + userAndScores.languages +
                        "')");
                }

                await FYSCloud.API.queryDatabase(
                    "INSERT INTO tag_category_score (userId, hobbys, movies, countries, books, music, games, sports, languages) VALUES " +
                    insertValues.join(", ")
                );
            }

            // console.log(await FYSCloud.API.queryDatabase(
            //     "SELECT * FROM `tag_category_score` ORDER BY ABS(hobbys - 2), ABS(movies - 2), ABS(countries - 2), ABS(books - 2), ABS(music - 2), ABS(games - 2), ABS(sports - 2), ABS(languages - 2);"
            // ));
            // return

            // testScores();
            // return

            let categories_and_tags = {};

            let tag_category = await FYSCloud.API.queryDatabase("SELECT * FROM `tag_category`;");

            let tag_to_id = {};
            let id_to_tag = {};
            let tag_to_category = {};


            for (let category of tag_category) {
                let category_tags = await FYSCloud.API.queryDatabase(
                    "SELECT * FROM `tag` WHERE `categoryId` = " + category.id + ";");

                categories_and_tags[category.name] = category_tags.reduce(function (tagNamen, tag) {
                    tagNamen.push(tag.name);

                    tag_to_id[tag.name] = tag.id;
                    id_to_tag[tag.id] = tag.name;

                    tag_to_category[tag.name] = tag_to_category[tag.name] || "";
                    tag_to_category[tag.name] = category.name;

                    return tagNamen;
                }, []);
            }

            async function updateTags() {
                let geselecteerdeTags = $(".scroll-current-tags .tag-button");

                await FYSCloud.API.queryDatabase(
                    "DELETE FROM `user_tag` WHERE `user_tag`.`userId` = " + userId + ";")

                if (geselecteerdeTags.length == 0) {
                    return;
                }

                let insertValues = [];

                let tag_category_score = {
                    hobbys: 0,
                    music: 0,
                    movies: 0,
                    games: 0,
                    countries: 0,
                    sports: 0,
                    books: 0,
                    languages: 0
                };

                console.log(tag_to_category);

                for (let tag of geselecteerdeTags) {
                    insertValues.push("('" + userId + "', '" + tag_to_id[$(tag).text()] + "')");
                    tag_category_score[tag_to_category[$(tag).text()].toLowerCase()]++;
                }

                await FYSCloud.API.queryDatabase(
                    "INSERT INTO user_tag (userId, tagId) VALUES " + insertValues.join(", ")
                );

                await FYSCloud.API.queryDatabase(
                    "DELETE FROM `tag_category_score` WHERE `userId` = " + userId + ";"
                );

                await FYSCloud.API.queryDatabase(
                    "INSERT INTO `tag_category_score` (userId, hobbys, music, movies, games, countries, sports, books, languages) VALUES (" +
                    userId + ", " + tag_category_score.hobbys + ", " + tag_category_score.music +
                    ", " + tag_category_score.movies + ", " + tag_category_score.games + ", " +
                    tag_category_score.countries + ", " + tag_category_score.sports + ", " +
                    tag_category_score.books + ", " + tag_category_score.languages + ");"
                );
            }

            let userId = (await SESSION).user.id;

            let geselecteerdeTags = await FYSCloud.API.queryDatabase(
                "SELECT * FROM `user_tag` WHERE `userId` = " + userId + ";");
            geselecteerdeTags = geselecteerdeTags.reduce(function (tagNamen, tag) {
                tagNamen.push(id_to_tag[tag.tagId]);
                return tagNamen;
            }, []);

            if (geselecteerdeTags.length) {
                $(".tag-counter").text(geselecteerdeTags.length);
                $('.js-help-text').hide();
            }

            for (let tag of geselecteerdeTags) {
                $(".scroll-current-tags").append('<button class="tag-button">' + tag + '</button>');
            }

            for (let categorie of Object.keys(categories_and_tags)) {
                for (let tag of categories_and_tags[categorie]) {
                    if (geselecteerdeTags.includes(tag)) {
                        continue;
                    }

                    $('.content.content-' + categorie.toLowerCase()).append('<button class="tag-button">' +
                        tag + '</button>')
                }
            }

            async function saveTags() {
                await FYSCloud.API.queryDatabase(
                    "DELETE FROM `tag` WHERE `tag`.`id` BETWEEN 1 AND 1000000;")

                await FYSCloud.API.queryDatabase(
                    "DELETE FROM `tag_category` WHERE `tag_category`.`id` BETWEEN 1 AND 1000000;")

                for (let categorie of Object.keys(categories_and_tags)) {

                    let categorieId = (await FYSCloud.API.queryDatabase(
                        "INSERT INTO tag_category (name) VALUES ('" + categorie + "')"
                    )).insertId

                    console.log(categorie)
                    console.log(categorieId)

                    let insertValues = [];

                    for (let tag of categories_and_tags[categorie]) {
                        insertValues.push("('" + tag + "', '" + categorieId + "')");
                    }

                    await FYSCloud.API.queryDatabase(
                        "INSERT INTO tag (name, categoryId) VALUES " + insertValues.join(", ")
                    );
                }
            };

            $("body").on('click', ".content .tag-button", function (e) {
                $(".tag-counter").text(
                    $(".scroll-current-tags .tag-button").length + 1
                );

                let tag = $(this).text();
                $(".scroll-current-tags").append('<button class="tag-button">' + tag + '</button>');
                $('.js-help-text').hide();
                $(this).detach();

                updateTags();
            });

            $("body").on("click", ".scroll-current-tags .tag-button", function (e) {
                let t = $(this).text();
                let categorie = "";

                CAT_KEYS:
                    for (let cat of Object.keys(categories_and_tags)) {
                        for (let tag of categories_and_tags[cat]) {
                            if (tag == t) {
                                categorie = cat;
                                break CAT_KEYS;
                            }
                        }
                    }

                $(".content.content-" + categorie.toLowerCase()).append(
                    '<button class="tag-button">' + t + '</button>');

                $(this).detach();

                $(".tag-counter").text(
                    $(".scroll-current-tags .tag-button").length
                );

                if (!$(".scroll-current-tags .tag-button").length) {
                    $('.js-help-text').show();
                }

                updateTags();
            });
        });
    </script>

</body>

</html>
